# Admin 管理端架构说明

## 当前架构

Admin 管理端目前**集成在同一个 Next.js 项目中**，使用独立的 Layout 和路由。

### 目录结构

```
frontend/
├── app/
│   ├── layout.tsx          # 主前端 Layout（包含 Sidebar、BottomNav）
│   ├── admin/
│   │   ├── layout.tsx      # Admin 独立 Layout（导航栏、认证）
│   │   ├── page.tsx        # Admin 主页（概览）
│   │   ├── stats/          # 数据统计
│   │   ├── users/          # 用户管理
│   │   ├── batches/        # 批次管理
│   │   ├── whitelist/      # 白名单管理
│   │   ├── nfts/           # NFT追溯
│   │   └── invite-codes/   # 邀请码管理
│   └── ...
```

## 架构选择：同一项目 vs 独立项目

### ✅ 推荐：同一项目（当前方案）

**优点：**
1. **代码共享**：可以共享 API 客户端、类型定义、工具函数
2. **统一部署**：一次部署，简化运维
3. **开发效率**：修改 API 时前后端同步，无需跨项目
4. **类型安全**：TypeScript 类型定义统一管理
5. **资源复用**：共享 UI 组件库、样式系统
6. **成本更低**：只需维护一个项目

**缺点：**
1. **代码耦合**：Admin 和前端代码在同一仓库
2. **打包体积**：Admin 代码会包含在构建产物中（可通过代码分割优化）
3. **权限控制**：需要在路由层面控制访问权限

**适用场景：**
- Admin 功能相对简单
- 团队规模较小
- 需要快速迭代
- 部署资源有限

### ❌ 不推荐：独立项目

**优点：**
1. **完全隔离**：Admin 和前端代码完全分离
2. **独立部署**：可以独立部署和扩展
3. **权限清晰**：可以完全独立的权限系统

**缺点：**
1. **代码重复**：API 客户端、类型定义需要维护两份
2. **同步困难**：API 变更需要同时更新两个项目
3. **开发效率低**：需要切换项目、重复配置
4. **部署复杂**：需要维护两套部署流程
5. **成本更高**：需要更多资源

**适用场景：**
- Admin 功能非常复杂（如独立的管理系统）
- 需要完全独立的权限和部署
- 团队规模大，有专门的管理端团队
- 有充足的资源

## 当前实现特点

### 1. 独立的 Layout

- **路径**：`app/admin/layout.tsx`
- **功能**：
  - 统一的认证检查
  - 侧边栏导航
  - 退出登录功能
  - 与主前端完全分离的样式

### 2. 路由保护

- Layout 层面统一处理认证
- 未登录自动显示登录页面
- 登录后可以访问所有 admin 页面

### 3. 导航系统

- 侧边栏导航，包含所有管理功能
- 当前页面高亮显示
- 响应式设计

### 4. 样式隔离

- Admin 使用独立的样式系统（Tailwind）
- 与主前端样式完全分离
- 统一的 Admin 设计语言

## 优化建议

### 1. 代码分割

如果担心打包体积，可以使用动态导入：

```typescript
// 只在需要时加载 admin 页面
const AdminPage = dynamic(() => import('./admin/page'), {
  ssr: false,
});
```

### 2. 环境变量控制

可以通过环境变量控制是否启用 admin：

```typescript
// 只在开发环境或特定环境显示 admin
if (process.env.NEXT_PUBLIC_ENABLE_ADMIN !== 'true') {
  return <NotFound />;
}
```

### 3. 中间件保护

使用 Next.js 中间件进行路由保护：

```typescript
// middleware.ts
export function middleware(request: NextRequest) {
  if (request.nextUrl.pathname.startsWith('/admin')) {
    // 检查认证
  }
}
```

## 总结

**当前架构（同一项目 + 独立 Layout）是最佳选择**，因为：

1. ✅ 开发效率高
2. ✅ 维护成本低
3. ✅ 代码复用好
4. ✅ 部署简单
5. ✅ 满足当前需求

如果未来 Admin 功能变得非常复杂，再考虑拆分为独立项目。

